- name: Ensure state dir exists
  run: mkdir -p state

- name: Cache state
  uses: actions/cache@v4
  with:
    path: state
    key: cyber-news-state-${{ github.run_id }}
    restore-keys: |
      cyber-news-state-

- name: Debug state BEFORE run
  run: |
    echo "== state before =="
    ls -la state || true
    test -f state/seen.json && head -c 400 state/seen.json || echo "no seen.json yet"

- name: Run bot
  env:
    DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
    STATE_DIR: state
    MAX_POSTS_PER_RUN: "10"
  run: node index.js

- name: Debug state AFTER run
  run: |
    echo "== state after =="
    ls -la state || true
    test -f state/seen.json && tail -c 400 state/seen.json || echo "no seen.json written"